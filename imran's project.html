<html><head><base href="." />
<title>Inventory Management System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root {
  --primary: #6b46c1;  /* Keep dark purple primary */
  --secondary: #1a1a1a;
  --accent: #805ad5;   /* Changed from blue to darker purple */
  --background: linear-gradient(135deg, #1a1a1a 0%, #2d3748 100%);
  --card-bg: linear-gradient(135deg, rgba(26, 26, 26, 0.9) 0%, rgba(45, 55, 72, 0.95) 100%);
  --text: #e2e8f0;
  --header-gradient: linear-gradient(135deg, #6b46c1 0%, #805ad5 100%);  /* Updated gradient */
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  padding: 0;
  background: var(--background);
  color: var(--text);
  min-height: 100vh;
}

.header {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  background: var(--header-gradient);
  color: white;
  padding: 1.5rem;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  flex-wrap: wrap;
  gap: 1rem;
}

.header h1 {
  font-size: 1.75rem;
  font-weight: 600;
  letter-spacing: 0.5px;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 1rem;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
}

.card {
  background: var(--card-bg);
  border-radius: 16px;
  padding: 2rem;
  box-shadow: 0 8px 30px rgba(0,0,0,0.08);
  border: 1px solid rgba(255,255,255,0.9);
  backdrop-filter: blur(10px);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 40px rgba(0,0,0,0.12);
}

.form-group {
  margin-bottom: 1.5rem;
}

label {
  display: block;
  margin-bottom: 0.75rem;
  font-weight: 500;
  color: #e2e8f0;
  font-size: 0.95rem;
}

input, select {
  width: 100%;
  padding: 0.75rem;
  border: 2px solid rgba(107, 70, 193, 0.3);
  border-radius: 8px;
  font-size: 1rem;
  background: rgba(26, 26, 26, 0.9);
  color: #e2e8f0;
  transition: all 0.3s ease;
}

input:focus, select:focus {
  border-color: var(--primary);
  box-shadow: 0 4px 12px rgba(107, 70, 193, 0.2);
  outline: none;
}

button {
  background: var(--header-gradient);
  color: white;
  border: none;
  padding: 0.875rem 1.75rem;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 500;
  letter-spacing: 0.3px;
  box-shadow: 0 4px 12px rgba(43,65,98,0.15);
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(43,65,98,0.25);
}

table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  margin-top: 1.5rem;
  background: var(--card-bg);
  box-shadow: 0 4px 16px rgba(0,0,0,0.06);
  border-radius: 12px;
  overflow: hidden;
}

th, td {
  padding: 1rem;
  border: 1px solid rgba(0,0,0,0.04);
  text-align: left;
}

th {
  background: var(--header-gradient);
  color: white;
  font-weight: 500;
  letter-spacing: 0.3px;
}

tr:hover {
  background: rgba(26, 26, 26, 0.8);
}

.audit-log {
  height: 200px;
  overflow-y: auto;
  background: var(--card-bg);
  padding: 1rem;
  border: 1px solid rgba(0,0,0,0.05);
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
  border-radius: 4px;
}

.status-badge {
  padding: 0.35rem 0.75rem;
  border-radius: 6px;
  font-size: 0.875rem;
  font-weight: 500;
  letter-spacing: 0.3px;
  text-transform: capitalize;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.status-active {
  background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);  /* Darker green gradient */
  color: white;
}

.status-inactive {
  background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);  /* Keep red for damaged */
  color: white;
}

.status-lent {
  background: linear-gradient(135deg, #d69e2e 0%, #b7791f 100%);  /* Darker yellow gradient */
  color: white;
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  align-items: center;
  justify-content: center;
}

.modal-content {
  background: linear-gradient(135deg, rgba(26, 26, 26, 0.95) 0%, rgba(45, 55, 72, 0.98) 100%);
  padding: 2rem;
  border-radius: 8px;
  max-width: 500px;
  width: 90%;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  border: 1px solid rgba(107, 70, 193, 0.3);
}

.action-buttons {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.action-buttons button {
  margin: 0; /* Remove margin since we're using gap */
  width: 100%;
}

.report-section {
  margin-top: 2rem;
}

.report-preview {
  max-height: 70vh;
  overflow-y: auto;
  padding: 1rem;
  background: var(--card-bg);
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.report-preview h3 {
  color: var(--primary);
  margin-top: 1.5rem;
  margin-bottom: 0.75rem;
}

.report-preview .stat-group {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.report-preview .stat-item {
  background: linear-gradient(135deg, rgba(26, 26, 26, 0.9) 0%, rgba(45, 55, 72, 0.95) 100%);
  padding: 1rem;
  border-radius: 4px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  transition: transform 0.2s;
}

.report-preview .stat-item:hover {
  transform: translateY(-2px);
}

.report-preview .stat-value {
  font-size: 1.5rem;
  font-weight: bold;
  background: var(--header-gradient);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
}

.report-preview .stat-label {
  font-size: 0.875rem;
  color: #a0aec0;
}

#locationModal {
  z-index: 1000;
}

#passwordRecoveryModal {
  z-index: 1001;
}

#newLocationModal {
  z-index: 1001;
}

.user-controls {
  display: flex;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.logout-btn {
  background: transparent;
  border: 1px solid white;
  color: white;
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
}

.logout-btn:hover {
  background: rgba(255, 255, 255, 0.1);
}

.forgot-password {
  display: block;
  margin-top: 0.5rem;
  font-size: 0.875rem;
  color: #e2e8f0;
  text-decoration: none;
}

.forgot-password:hover {
  text-decoration: underline;
}

.inventory-controls {
  margin-bottom: 1.5rem;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  align-items: end;
}

#item-search {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid rgba(0,0,0,0.1);
  border-radius: 4px;
}

.validation-message {
  color: #e53e3e;
  font-size: 0.875rem;
  margin-top: 0.25rem;
  display: none;
}

.form-group.error input,
.form-group.error select {
  border-color: #e53e3e;
}

.form-group.error .validation-message {
  display: block;
}

@media (max-width: 768px) {
  table {
    display: block;
    overflow-x: auto;
    white-space: nowrap;
  }

  .header {
    flex-direction: column;
    text-align: center;
  }

  .modal-content {
    width: 95%;
    margin: 1rem;
    padding: 1rem;
  }

  .action-buttons {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .action-buttons button {
    width: 100%;
    margin: 0;
  }

  .grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 480px) {
  .user-controls {
    flex-direction: column;
    width: 100%;
  }

  .logout-btn {
    width: 100%;
  }

  #user-info {
    text-align: center;
    width: 100%;
  }

  .form-group {
    margin-bottom: 0.75rem;
  }

  button {
    width: 100%;
  }
}
</style>
</head>
<body>
<div class="header">
  <h1>Inventory Management System</h1>
  <div class="user-controls">
    <div id="user-info">
      Logged in as: <span id="current-user">Head Of Department</span>
      | Location: <span id="current-location">Not Selected</span>
    </div>
    <button class="logout-btn" onclick="inventorySystem.logout()">Logout</button>
  </div>
</div>

<div class="container">
  <div class="grid">
    <div class="card">
      <h2>Add New Item</h2>
      <form id="asset-form">
        <div class="form-group">
          <label for="asset-name">Item Name</label>
          <input type="text" id="asset-name" required>
        </div>
        <div class="form-group">
          <label for="category">Category</label>
          <select id="category" required>
            <option value="">Select Category</option>
            <option value="IT Equipment">IT Equipment</option>
            <option value="Furniture">Furniture</option>
            <option value="Stationery">Stationery</option>
            <option value="Special Equipment">Special Equipment</option>
          </select>
        </div>
        <div class="form-group">
          <label for="asset-quantity">Quantity</label>
          <input type="number" id="asset-quantity" min="1" value="1" required>
        </div>
        <div class="form-group">
          <label for="asset-price">Purchase Price (₦)</label>
          <input type="number" id="asset-price" min="5000" step="100" required>
        </div>
        <button type="submit">Add Item</button>
      </form>
    </div>

    <div class="card">
      <h2>Inventory Activity</h2>
      <div class="form-group">
        <label for="activity-start-date">From:</label>
        <input type="date" id="activity-start-date" onchange="inventorySystem.filterActivityLog()">
      </div>
      <div class="form-group">
        <label for="activity-end-date">To:</label>
        <input type="date" id="activity-end-date" onchange="inventorySystem.filterActivityLog()">
      </div>
      <div class="audit-log" id="audit-log">
        <div>Login required to view activity log</div>
      </div>
    </div>
  </div>

  <div class="card" style="margin-top: 2rem;">
    <h2>Inventory</h2>
    
    <div class="inventory-controls">
      <div class="form-group">
        <label for="category-filter">Select Category:</label>
        <select id="category-filter" onchange="inventorySystem.filterByCategory()">
          <option value="all">All Categories</option>
          <option value="IT Equipment">IT Equipment</option>
          <option value="Furniture">Furniture</option>
          <option value="Stationery">Stationery</option>
          <option value="Special Equipment">Special Equipment</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="item-search">Search Items:</label>
        <input type="text" id="item-search" placeholder="Search by ID, name, or status..." 
          oninput="inventorySystem.searchItems()">
      </div>
    </div>

    <table id="inventory-table">
      <thead>
        <tr>
          <th>Item ID</th>
          <th>Name</th>
          <th>Category</th>
          <th>Purchase Price (₦)</th>
          <th>Status</th>
          <th>Date Added</th>
          <th>Last Updated</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="inventory-body">
        <!-- Inventory items will be added here -->
        <tr>
          <td>ICIT0001</td>
          <td>Dell Laptop</td>
          <td>IT Equipment</td>
          <td>${350000.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('ICIT0001')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('ICIT0001')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('ICIT0001')">Delete</button>
          </td>
        </tr>
        <tr>
          <td>ICIT0002</td>
          <td>HP Printer</td>
          <td>IT Equipment</td>
          <td>${150000.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('ICIT0002')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('ICIT0002')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('ICIT0002')">Delete</button>
          </td>
        </tr>
        <tr>
          <td>ICFU0001</td>
          <td>Executive Chair</td>
          <td>Furniture</td>
          <td>${45000.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('ICFU0001')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('ICFU0001')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('ICFU0001')">Delete</button>
          </td>
        </tr>
        <tr>
          <td>ICFU0002</td>
          <td>Filing Cabinet</td>
          <td>Furniture</td>
          <td>${60000.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('ICFU0002')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('ICFU0002')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('ICFU0002')">Delete</button>
          </td>
        </tr>
        <tr>
          <td>ICST0001</td>
          <td>Paper Ream</td>
          <td>Stationery</td>
          <td>${3000.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('ICST0001')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('ICST0001')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('ICST0001')">Delete</button>
          </td>
        </tr>
        <tr>
          <td>ICST0002</td>
          <td>Stapler Set</td>
          <td>Stationery</td>
          <td>${1500.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('ICST0002')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('ICST0002')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('ICST0002')">Delete</button>
          </td>
        </tr>
        <tr>
          <td>ICEQ0001</td>
          <td>Projector</td>
          <td>Special Equipment</td>
          <td>${200000.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('ICEQ0001')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('ICEQ0001')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('ICEQ0001')">Delete</button>
          </td>
        </tr>
        <tr>
          <td>ICEQ0002</td>
          <td>Scanner</td>
          <td>Special Equipment</td>
          <td>${70000.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('ICEQ0002')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('ICEQ0002')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('ICEQ0002')">Delete</button>
          </td>
        </tr>
        <tr>
          <td>AHIT0001</td>
          <td>Desktop Computer</td>
          <td>IT Equipment</td>
          <td>${400000.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('AHIT0001')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('AHIT0001')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('AHIT0001')">Delete</button>
          </td>
        </tr>
        <tr>
          <td>AHFU0001</td>
          <td>Office Desk</td>
          <td>Furniture</td>
          <td>${80000.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('AHFU0001')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('AHFU0001')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('AHFU0001')">Delete</button>
          </td>
        </tr>
        <tr>
          <td>AHST0001</td>
          <td>File Folders</td>
          <td>Stationery</td>
          <td>${2000.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('AHST0001')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('AHST0001')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('AHST0001')">Delete</button>
          </td>
        </tr>
        <tr>
          <td>AHEQ0001</td>
          <td>Paper Shredder</td>
          <td>Special Equipment</td>
          <td>${150000.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('AHEQ0001')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('AHEQ0001')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('AHEQ0001')">Delete</button>
          </td>
        </tr>
        <tr>
          <td>PAIT0001</td>
          <td>Laptop</td>
          <td>IT Equipment</td>
          <td>${300000.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('PAIT0001')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('PAIT0001')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('PAIT0001')">Delete</button>
          </td>
        </tr>
        <tr>
          <td>PAFU0001</td>
          <td>Conference Table</td>
          <td>Furniture</td>
          <td>${120000.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('PAFU0001')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('PAFU0001')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('PAFU0001')">Delete</button>
          </td>
        </tr>
        <tr>
          <td>PAST0001</td>
          <td>Notepads</td>
          <td>Stationery</td>
          <td>${1000.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('PAST0001')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('PAST0001')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('PAST0001')">Delete</button>
          </td>
        </tr>
        <tr>
          <td>PAEQ0001</td>
          <td>Digital Camera</td>
          <td>Special Equipment</td>
          <td>${250000.toLocaleString()}</td>
          <td><span class="status-badge status-active">active</span></td>
          <td>${new Date('2024-01-01T00:00:00.000Z').toLocaleDateString()}</td>
          <td>${new Date().toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('PAEQ0001')">Mark Damaged</button>
            <button onclick="inventorySystem.showLendModal('PAEQ0001')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('PAEQ0001')">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="card report-section">
    <h2>Inventory Report</h2>
    <div class="form-group">
      <label for="report-start-date">Start Date:</label>
      <input type="date" id="report-start-date" required>
    </div>
    <div class="form-group">
      <label for="report-end-date">End Date:</label>
      <input type="date" id="report-end-date" required>
    </div>
    <div class="form-group">
      <label for="report-email">Email Address:</label>
      <input type="email" id="report-email" required placeholder="Enter your email">
    </div>
    <button onclick="inventorySystem.generateReport()">Generate & Send Report</button>
    <div id="report-status"></div>
  </div>
</div>

<div id="locationModal" class="modal">
  <div class="modal-content">
    <h2>Select Location</h2>
    <form id="location-form" onsubmit="inventorySystem.validateLocation(event)">
      <div class="form-group">
        <label for="location-select">Choose Location:</label>
        <select id="location-select" required>
          <option value="">Select Location</option>
          <!-- Locations loaded dynamically -->
          <option value="ICT Unit">ICT Unit</option>
          <option value="A&HR">A&HR</option>
          <option value="Public Affairs Unit">Public Affairs Unit</option>
        </select>
        <div class="validation-message">Please select a location</div>
      </div>
      <div class="form-group">
        <label for="location-password">Location Password:</label>
        <input type="password" id="location-password" required>
        <div class="validation-message">Please enter the location password</div>
        <a href="#" onclick="inventorySystem.showPasswordRecovery()" class="forgot-password">Forgot Password?</a>
      </div>
      <button type="submit">Access Location</button>
      <button type="button" onclick="inventorySystem.showNewLocationForm()">Add New Location</button>
    </form>
  </div>
</div>

<div id="newLocationModal" class="modal">
  <div class="modal-content">
    <h2>Add New Location</h2>
    <div class="form-group">
      <label for="new-location-name">Location Name:</label>
      <input type="text" id="new-location-name" required>
    </div>
    <div class="form-group">
      <label for="new-location-password">Set Password:</label>
      <input type="password" id="new-location-password" required>
    </div>
    <div class="form-group">
      <label for="confirm-location-password">Confirm Password:</label>
      <input type="password" id="confirm-location-password" required>
    </div>
    <button onclick="inventorySystem.createNewLocation()">Create Location</button>
    <button onclick="inventorySystem.closeModal('newLocationModal')">Cancel</button>
  </div>
</div>

<div id="lendModal" class="modal">
  <div class="modal-content">
    <h2>Lend Item</h2>
    <div class="form-group">
      <label for="lend-office">Lend to Location:</label>
      <select id="lend-office" required>
        <option value="">Select Location</option>
      </select>
    </div>
    <button onclick="inventorySystem.confirmLend()">Confirm</button>
    <button onclick="inventorySystem.closeModal('lendModal')">Cancel</button>
  </div>
</div>

<div id="reportPreviewModal" class="modal">
  <div class="modal-content" style="max-width: 800px">
    <h2>Report Preview</h2>
    <div id="report-preview-content" class="report-preview"></div>
    <div class="form-group" style="margin-top: 1rem;">
      <button onclick="inventorySystem.sendReport()">Send Report</button>
      <button onclick="inventorySystem.closeModal('reportPreviewModal')">Cancel</button>
    </div>
  </div>
</div>

<div id="passwordRecoveryModal" class="modal">
  <div class="modal-content">
    <h2>Password Reset</h2>
    <p>To reset your location's password, please enter the recovery password:</p>
    <div class="form-group">
      <label for="recovery-ict-password">Recovery Password:</label>
      <input type="password" id="recovery-ict-password" required>
    </div>
    <div class="form-group">
      <label for="recovery-location">Location:</label>
      <select id="recovery-location" required>
        <option value="">Select Location</option>
        <option value="ICT Unit">ICT Unit</option>
        <option value="A&HR">A&HR</option>
        <option value="Public Affairs Unit">Public Affairs Unit</option>
      </select>
    </div>
    <div class="form-group">
      <label for="new-recovery-password">New Password:</label>
      <input type="password" id="new-recovery-password" required>
    </div>
    <div class="form-group">
      <label for="confirm-recovery-password">Confirm New Password:</label>
      <input type="password" id="confirm-recovery-password" required>
    </div>
    <button onclick="inventorySystem.recoverPassword()">Reset Password</button>
    <button onclick="inventorySystem.closeModal('passwordRecoveryModal')">Cancel</button>
  </div>
</div>

<script>
class InventorySystem {
  constructor() {
    this.locations = [
      { name: 'ICT Unit', password: '1234' },
      { name: 'A&HR', password: '1234' },
      { name: 'Public Affairs Unit', password: '1234' }
    ];
    this.currentLocation = null;
    this.inventory = [
      {
        id: 'ICIT0001',
        name: 'Dell Laptop',
        category: 'IT Equipment',
        price: 350000,
        originalLocation: 'ICT Unit',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      },
      {
        id: 'ICIT0002',
        name: 'HP Printer',
        category: 'IT Equipment',
        price: 150000,
        originalLocation: 'ICT Unit',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      },
      {
        id: 'ICFU0001',
        name: 'Executive Chair',
        category: 'Furniture',
        price: 45000,
        originalLocation: 'ICT Unit',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      },
      {
        id: 'ICFU0002',
        name: 'Filing Cabinet',
        category: 'Furniture',
        price: 60000,
        originalLocation: 'ICT Unit',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      },
      {
        id: 'ICST0001',
        name: 'Paper Ream',
        category: 'Stationery',
        price: 3000,
        originalLocation: 'ICT Unit',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      },
      {
        id: 'ICST0002',
        name: 'Stapler Set',
        category: 'Stationery',
        price: 1500,
        originalLocation: 'ICT Unit',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      },
      {
        id: 'ICEQ0001',
        name: 'Projector',
        category: 'Special Equipment',
        price: 200000,
        originalLocation: 'ICT Unit',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      },
      {
        id: 'ICEQ0002',
        name: 'Scanner',
        category: 'Special Equipment',
        price: 70000,
        originalLocation: 'ICT Unit',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      },
      {
        id: 'AHIT0001',
        name: 'Desktop Computer',
        category: 'IT Equipment',
        price: 400000,
        originalLocation: 'A&HR',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      },
      {
        id: 'AHFU0001',
        name: 'Office Desk',
        category: 'Furniture',
        price: 80000,
        originalLocation: 'A&HR',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      },
      {
        id: 'AHST0001',
        name: 'File Folders',
        category: 'Stationery',
        price: 2000,
        originalLocation: 'A&HR',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      },
      {
        id: 'AHEQ0001',
        name: 'Paper Shredder',
        category: 'Special Equipment',
        price: 150000,
        originalLocation: 'A&HR',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      },
      {
        id: 'PAIT0001',
        name: 'Laptop',
        category: 'IT Equipment',
        price: 300000,
        originalLocation: 'Public Affairs Unit',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      },
      {
        id: 'PAFU0001',
        name: 'Conference Table',
        category: 'Furniture',
        price: 120000,
        originalLocation: 'Public Affairs Unit',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      },
      {
        id: 'PAST0001',
        name: 'Notepads',
        category: 'Stationery',
        price: 1000,
        originalLocation: 'Public Affairs Unit',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      },
      {
        id: 'PAEQ0001',
        name: 'Digital Camera',
        category: 'Special Equipment',
        price: 250000,
        originalLocation: 'Public Affairs Unit',
        status: 'active',
        dateAdded: '2024-01-01T00:00:00.000Z',
        lastUpdated: new Date().toISOString()
      }
    ];
    this.deletedItems = []; // Add this new property to track deleted items
    this.auditLog = [];
    this.selectedItemId = null;
    this.lendingHistory = [];
    this.currentReport = null;
    this.itemHistory = {
      additions: [],
      damages: []
    };
    this.inactivityTimeout = null;
    this.inactivityDuration = 5 * 60 * 1000; // 5 minutes in milliseconds
    this.init();
  }

  init() {
    document.getElementById('current-location').textContent = 'Not Selected';
    this.showLocationModal();
    this.setupEventListeners();
    document.addEventListener('mousemove', () => this.resetInactivityTimer());
    document.addEventListener('keypress', () => this.resetInactivityTimer());
    document.addEventListener('click', () => this.resetInactivityTimer());
    window.addEventListener('beforeunload', () => this.handleTabClose());
  }

  showLocationModal() {
    const select = document.getElementById('location-select');
    select.innerHTML = '<option value="">Select Location</option>';
    this.locations.forEach(loc => {
      const option = document.createElement('option');
      option.value = loc.name;
      option.textContent = loc.name;
      select.appendChild(option);
    });
    document.getElementById('locationModal').style.display = 'flex';
  }

  showPasswordRecovery() {
    const select = document.getElementById('recovery-location');
    select.innerHTML = '<option value="">Select Location</option>';
    this.locations.forEach(loc => {
      const option = document.createElement('option');
      option.value = loc.name;
      option.textContent = loc.name;
      select.appendChild(option);
    });
    
    this.closeModal('locationModal');
    document.getElementById('passwordRecoveryModal').style.display = 'flex';
  }

  validateLocation(event) {
    if (event) {
        event.preventDefault(); // Prevent default form submission
    }
    
    const locationSelect = document.getElementById('location-select');
    const passwordInput = document.getElementById('location-password');
    const locationGroup = locationSelect.parentElement;
    const passwordGroup = passwordInput.parentElement;
    let isValid = true;

    // Reset previous validation states
    locationGroup.classList.remove('error');
    passwordGroup.classList.remove('error');

    // Validate location selection
    if (!locationSelect.value) {
        locationGroup.classList.add('error');
        isValid = false;
    }

    // Validate password
    if (!passwordInput.value) {
        passwordGroup.classList.add('error');
        isValid = false;
    }

    if (!isValid) {
        return;
    }

    const location = this.locations.find(l => l.name === locationSelect.value);
    if (location && location.password === passwordInput.value) {
        this.currentLocation = locationSelect.value;
        document.getElementById('current-location').textContent = locationSelect.value;
        this.closeModal('locationModal');
        this.updateUI();
        this.logActivity(`Accessed location: ${locationSelect.value}`);
        this.resetInactivityTimer();
    } else {
        passwordGroup.classList.add('error');
        passwordGroup.querySelector('.validation-message').textContent = 'Invalid password';
    }
  }

  recoverPassword() {
    const recoveryPassword = document.getElementById('recovery-ict-password').value;
    const locationName = document.getElementById('recovery-location').value;
    const newPassword = document.getElementById('new-recovery-password').value;
    const confirmPassword = document.getElementById('confirm-recovery-password').value;
    
    if (recoveryPassword !== '5678') {
        alert('Invalid password');
        return;
    }

    if (!locationName) {
        alert('Please select a location');
        return;
    }

    if (newPassword !== confirmPassword) {
        alert('Passwords do not match');
        return;
    }

    const location = this.locations.find(l => l.name === locationName);
    if (location) {
        location.password = newPassword;
        this.logActivity(`Password reset for location: ${locationName}`);
        alert('Password has been reset successfully');
        this.closeModal('passwordRecoveryModal');
        this.showLocationModal();
    }
  }

  resetInactivityTimer() {
    if (!this.currentLocation) return; // Don't start timer if not logged in

    clearTimeout(this.inactivityTimeout);
    this.inactivityTimeout = setTimeout(() => {
      this.autoLogout('inactivity');
    }, this.inactivityDuration);
  }

  handleTabClose() {
    if (this.currentLocation) {
      this.logActivity('User session ended - browser closed');
      this.logout(true); // Force logout without confirmation
    }
  }

  autoLogout(reason) {
    if (this.currentLocation) {
      this.logActivity(`Auto logout due to ${reason}`);
      this.logout(true); // Force logout without confirmation
      alert(`You have been logged out due to ${reason}`);
    }
  }

  showNewLocationForm() {
    const ictPassword = prompt('Please enter password to create new location:');
    
    if (ictPassword !== '5678') {
      alert('Invalid password');
      return;
    }
    
    this.closeModal('locationModal');
    document.getElementById('newLocationModal').style.display = 'flex';
  }

  createNewLocation() {
    const name = document.getElementById('new-location-name').value;
    const password = document.getElementById('new-location-password').value;
    const confirmPassword = document.getElementById('confirm-location-password').value;

    if (password !== confirmPassword) {
      alert('Passwords do not match');
      return;
    }

    if (this.locations.some(l => l.name === name)) {
      alert('Location already exists');
      return;
    }

    this.locations.push({ name, password });
    document.getElementById('new-location-name').value = '';
    document.getElementById('new-location-password').value = '';
    document.getElementById('confirm-location-password').value = '';
    this.closeModal('newLocationModal');
    this.showLocationModal();
    this.logActivity(`Created new location: ${name}`);
  }

  setupEventListeners() {
    document.getElementById('asset-form').addEventListener('submit', (e) => {
      e.preventDefault();
      this.addItem();
    });
  }

  addItem() {
    const itemName = document.getElementById('asset-name').value;
    const category = document.getElementById('category').value;
    const quantity = parseInt(document.getElementById('asset-quantity').value) || 1;
    const price = parseFloat(document.getElementById('asset-price').value);
    
    // Generate location code
    const locationCodes = {
      'ICT Unit': 'IC',
      'A&HR': 'AH',
      'Public Affairs Unit': 'PA'
    };
    const locationCode = locationCodes[this.currentLocation];
    
    // Generate category code
    const categoryCodes = {
      'IT Equipment': 'IT',
      'Furniture': 'FU',
      'Stationery': 'ST',
      'Special Equipment': 'EQ'
    };
    const categoryCode = categoryCodes[category];
    
    // Find all EVER USED items for this location and category
    const prefix = locationCode + categoryCode;
    
    // Get all numbers ever used
    const existingNumbers = new Set();
    
    // Check current inventory
    this.inventory
      .filter(item => item.id.startsWith(prefix))
      .forEach(item => existingNumbers.add(parseInt(item.id.slice(-4))));
    
    // Check audit log for deleted items
    this.auditLog
      .filter(log => log.includes('Deleted item:') && log.includes(prefix))
      .forEach(log => {
        const match = log.match(new RegExp(prefix + '(\\d{4})'));
        if (match) {
          existingNumbers.add(parseInt(match[1]));
        }
      });
    
    // Find the next available number
    let nextNumber = 1;
    const addedItems = [];
    
    // Add items based on quantity
    for (let i = 0; i < quantity; i++) {
      // Find next available number
      while (existingNumbers.has(nextNumber)) {
        nextNumber++;
      }
      
      // Generate new ID
      const itemId = prefix + nextNumber.toString().padStart(4, '0');
      existingNumbers.add(nextNumber); // Add to set so next item gets next number
      
      const item = {
        id: itemId,
        name: itemName,
        category: category,
        price: price,
        originalLocation: this.currentLocation,
        status: 'active',
        dateAdded: new Date().toISOString(),
        lastUpdated: new Date().toISOString()
      };

      this.inventory.push(item);
      addedItems.push(item);
      
      // Add to additions history
      this.itemHistory.additions.push({
        ...item,
        addedDate: new Date().toISOString()
      });

      nextNumber++; // Increment for next item
    }
    
    // Sort inventory by ID
    this.inventory.sort((a, b) => a.id.localeCompare(b.id));

    // Log the activity with quantity information
    if (quantity === 1) {
      this.logActivity(`Added new item: ${addedItems[0].id} - ${itemName}`);
    } else {
      const itemIds = addedItems.map(item => item.id).join(', ');
      this.logActivity(`Added ${quantity} new items: ${itemIds} - ${itemName}`);
    }

    this.updateUI();
    this.resetForm();
  }

  logActivity(message) {
    const timestamp = new Date().toISOString();
    this.auditLog.unshift(`[${timestamp}] ${message} - location: ${this.currentLocation}`);
    this.updateAuditLog();
  }

  updateUI() {
    const selectedCategory = document.getElementById('category-filter').value;
    const searchTerm = document.getElementById('item-search').value.toLowerCase();
    this.updateInventoryTable(selectedCategory, searchTerm);
    this.updateAuditLog();
  }

  updateAuditLog() {
    this.filterActivityLog();
  }

  filterActivityLog() {
    const startDate = document.getElementById('activity-start-date').value;
    const endDate = document.getElementById('activity-end-date').value;
    
    const auditLogElement = document.getElementById('audit-log');
    if (!this.currentLocation) {
      auditLogElement.innerHTML = '<div>Login required to view activity log</div>';
      return;
    }

    let filteredLogs = this.auditLog.filter(entry => 
      entry.includes(`location: ${this.currentLocation}`) || 
      entry.includes(`Accessed location: ${this.currentLocation}`)
    );

    if (startDate && endDate) {
      const start = new Date(startDate);
      const end = new Date(endDate);
      end.setHours(23, 59, 59); // Include full end date

      filteredLogs = filteredLogs.filter(entry => {
        const logDate = new Date(entry.match(/\[(.*?)\]/)[1]);
        return logDate >= start && logDate <= end;
      });
    }

    auditLogElement.innerHTML = filteredLogs
      .map(entry => `<div>${entry}</div>`)
      .join('');
  }

  updateInventoryTable(categoryFilter = 'all', searchTerm = '') {
    const tbody = document.getElementById('inventory-body');
    const tableHeader = document.querySelector('#inventory-table thead tr');
    tbody.innerHTML = '';

    tableHeader.innerHTML = `
      <th>Item ID</th>
      <th>Name</th>
      ${categoryFilter === 'all' ? '<th>Category</th>' : ''}
      <th>Purchase Price (₦)</th>
      <th>Status</th>
      <th>Date Added</th>
      <th>Last Updated</th>
      <th>Actions</th>
    `;

    this.inventory
      .filter(item => item.originalLocation === this.currentLocation)
      .filter(item => categoryFilter === 'all' || item.category === categoryFilter)
      .filter(item => 
        item.id.toLowerCase().includes(searchTerm) || 
        item.name.toLowerCase().includes(searchTerm) ||
        item.status.toLowerCase().includes(searchTerm)
      )
      .forEach(item => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.id}</td>
          <td>${item.name}</td>
          ${categoryFilter === 'all' ? `<td>${item.category}</td>` : ''}
          <td>${item.price.toLocaleString()}</td>
          <td><span class="status-badge status-${item.status}">${item.status}${item.lentTo ? ` to ${item.lentTo}` : ''}</span></td>
          <td>${new Date(item.dateAdded).toLocaleDateString()}</td>
          <td>${new Date(item.lastUpdated).toLocaleDateString()}</td>
          <td class="action-buttons">
            <button onclick="inventorySystem.toggleItemStatus('${item.id}')">${item.status === 'active' ? 'Mark Damaged' : 'Mark Active'}</button>
            <button onclick="inventorySystem.showLendModal('${item.id}')">Lend Out</button>
            <button onclick="inventorySystem.deleteItem('${item.id}')">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
  }

  filterByCategory() {
    const selectedCategory = document.getElementById('category-filter').value;
    const searchTerm = document.getElementById('item-search').value.toLowerCase();
    this.updateInventoryTable(selectedCategory, searchTerm);
  }

  searchItems() {
    const selectedCategory = document.getElementById('category-filter').value;
    const searchTerm = document.getElementById('item-search').value.toLowerCase();
    this.updateInventoryTable(selectedCategory, searchTerm);
  }

  toggleItemStatus(itemId) {
    const item = this.inventory.find(i => i.id === itemId);
    if (item) {
        const previousStatus = item.status;
        item.status = item.status === 'active' ? 'inactive' : 'active';

        if (previousStatus === 'active' && item.status === 'inactive') {
            this.itemHistory.damages.push({
                ...item,
                damageDate: new Date().toISOString()
            });
        }

        if (item.status === 'active') {
            delete item.lentTo;
        }
        item.lastUpdated = new Date().toISOString();
        this.logActivity(`Changed status of item ${itemId} to ${item.status}`);
        
        const selectedCategory = document.getElementById('category-filter').value;
        const searchTerm = document.getElementById('item-search').value.toLowerCase();
        this.updateInventoryTable(selectedCategory, searchTerm);
        this.updateAuditLog();
    }
  }

  showLendModal(itemId) {
    this.selectedItemId = itemId;
    const modal = document.getElementById('lendModal');
    
    const officeSelect = document.getElementById('lend-office');
    officeSelect.innerHTML = '<option value="">Select Location</option>';
    
    this.locations
      .filter(loc => loc.name !== this.currentLocation)
      .forEach(loc => {
        const option = document.createElement('option');
        option.value = loc.name;
        option.textContent = loc.name;
        officeSelect.appendChild(option);
      });
    
    modal.style.display = 'flex';
  }

  closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
    if (modalId === 'newLocationModal' || modalId === 'passwordRecoveryModal' || !this.currentLocation) {
      this.showLocationModal();
    }
  }

  confirmLend() {
    const lendOffice = document.getElementById('lend-office').value;
    const item = this.inventory.find(i => i.id === this.selectedItemId);
    if (item) {
        item.status = 'lent';
        item.lentTo = lendOffice;
        item.lastUpdated = new Date().toISOString();

        // Add to lending history with original location
        this.lendingHistory.push({
          itemId: item.id,
          itemName: item.name,
          category: item.category,
          originalLocation: item.originalLocation,
          lentTo: lendOffice,
          lentDate: new Date().toISOString()
        });

        this.logActivity(`Item ${item.id} lent to ${lendOffice}`);
        
        const selectedCategory = document.getElementById('category-filter').value;
        const searchTerm = document.getElementById('item-search').value.toLowerCase();
        this.updateInventoryTable(selectedCategory, searchTerm);
        this.updateAuditLog();
    }
    this.closeModal('lendModal');
    document.getElementById('lend-office').value = '';
  }

  deleteItem(itemId) {
    if (!confirm('Are you sure you want to delete this item?')) {
      return;
    }

    const password = prompt('Please enter password to confirm deletion:');
    const location = this.locations.find(l => l.name === this.currentLocation);
    
    if (!location || password !== location.password) {
      alert('Invalid password. Deletion cancelled.');
      return;
    }

    const index = this.inventory.findIndex(i => i.id === itemId);
    if (index !== -1) {
      const item = this.inventory[index];
      this.inventory.splice(index, 1);
      
      // Add deletion record with both add and delete dates
      this.deletedItems.push({
        ...item,
        deleteDate: new Date().toISOString()
      });
      
      this.logActivity(`Deleted item: ${item.id} - ${item.name}`);
      
      const selectedCategory = document.getElementById('category-filter').value;
      const searchTerm = document.getElementById('item-search').value.toLowerCase();
      this.updateInventoryTable(selectedCategory, searchTerm);
      this.updateAuditLog();
    }
  }

  generateReport() {
    const emailInput = document.getElementById('report-email');
    const startDate = document.getElementById('report-start-date').value;
    const endDate = document.getElementById('report-end-date').value;
    const statusDiv = document.getElementById('report-status');

    if (!startDate || !endDate) {
      statusDiv.innerHTML = '<p style="color: red;">Please select both start and end dates.</p>';
      return;
    }

    if (!emailInput.value) {
      statusDiv.innerHTML = '<p style="color: red;">Please enter an email address.</p>';
      return;
    }

    const report = this.generateReportData();
    this.showReportPreview(report, emailInput.value);
  }

  generateReportData() {
    const startDate = new Date(document.getElementById('report-start-date').value);
    const endDate = new Date(document.getElementById('report-end-date').value);
    endDate.setHours(23, 59, 59); // Include full end date
    
    const locationInventory = this.inventory.filter(i => i.originalLocation === this.currentLocation);
    
    // Calculate items at period start
    const itemsAddedAfterStart = this.itemHistory.additions.filter(item => 
      item.originalLocation === this.currentLocation &&
      new Date(item.addedDate) > startDate
    ).length;

    const deletedItemsAfterStart = this.deletedItems
      .filter(item => 
        item.originalLocation === this.currentLocation &&
        new Date(item.deleteDate) > startDate
      ).length;

    const itemsAtStart = locationInventory.length - itemsAddedAfterStart + deletedItemsAfterStart;

    // Calculate statistics for the period
    const periodAdditions = this.itemHistory.additions.filter(item => 
      item.originalLocation === this.currentLocation &&
      new Date(item.addedDate) >= startDate &&
      new Date(item.addedDate) <= endDate
    );

    const periodDamages = this.itemHistory.damages.filter(damage => 
      new Date(damage.damageDate) >= startDate &&
      new Date(damage.damageDate) <= endDate
    );

    const periodLending = this.lendingHistory.filter(lend => 
      new Date(lend.lentDate) >= startDate &&
      new Date(lend.lentDate) <= endDate
    );
    
    const deletionsInPeriod = this.deletedItems
      .filter(item => 
        item.originalLocation === this.currentLocation &&
        new Date(item.deleteDate) >= startDate &&
        new Date(item.deleteDate) <= endDate
      ).length;

    // Current status counts
    const active = locationInventory.filter(i => i.status === 'active').length;
    const damaged = locationInventory.filter(i => i.status === 'inactive').length;
    const lent = locationInventory.filter(i => i.status === 'lent').length;

    return {
      period: `${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()}`,
      itemsAtStart,
      total: locationInventory.length + deletionsInPeriod,
      deletionsInPeriod,
      newItemsInPeriod: periodAdditions.length,
      damagesInPeriod: periodDamages.length,
      lendsInPeriod: periodLending.length,
      active,
      damaged,
      lent,
      fullInventory: locationInventory
    };
  }

  showReportPreview(report, email) {
    const previewContent = document.getElementById('report-preview-content');
    
    const startDate = new Date(document.getElementById('report-start-date').value);
    const endDate = new Date(document.getElementById('report-end-date').value);
    endDate.setHours(23, 59, 59);

    // Get new items in period
    const newItems = this.itemHistory.additions.filter(item => 
      item.originalLocation === this.currentLocation &&
      new Date(item.addedDate) >= startDate &&
      new Date(item.addedDate) <= endDate
    );

    // Get damaged items in period
    const damages = this.itemHistory.damages.filter(damage => 
      damage.originalLocation === this.currentLocation &&
      new Date(damage.damageDate) >= startDate &&
      new Date(damage.damageDate) <= endDate
    );

    // Get lending activity in period
    const lending = this.lendingHistory.filter(lend => 
      lend.originalLocation === this.currentLocation &&
      new Date(lend.lentDate) >= startDate &&
      new Date(lend.lentDate) <= endDate
    );

    // Get deleted items in period
    const deletedItemsInPeriod = this.deletedItems.filter(item => 
      item.originalLocation === this.currentLocation &&
      new Date(item.deleteDate) >= startDate &&
      new Date(item.deleteDate) <= endDate
    );

    // New Items Details section
    const newItemsTable = newItems.length > 0 ? `
      <h3>New Items Added During Period</h3>
      <table>
        <thead>
          <tr>
            <th>Item ID</th>
            <th>Item Name</th>
            <th>Category</th>
            <th>Purchase Price (₦)</th>
            <th>Date Added</th>
          </tr>
        </thead>
        <tbody>
          ${newItems.map(record => `
            <tr>
              <td>${record.id}</td>
              <td>${record.name}</td>
              <td>${record.category}</td>
              <td>${record.price.toLocaleString()}</td>
              <td>${new Date(record.addedDate).toLocaleDateString()}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    ` : '<h3>No New Items Added During Period</h3>';

    // Damaged Items Details section
    const damagedItemsTable = damages.length > 0 ? `
      <h3>Items Damaged During Period</h3>
      <table>
        <thead>
          <tr>
            <th>Item ID</th>
            <th>Item Name</th>
            <th>Category</th>
            <th>Date Damaged</th>
          </tr>
        </thead>
        <tbody>
          ${damages.map(record => `
            <tr>
              <td>${record.id}</td>
              <td>${record.name}</td>
              <td>${record.category}</td>
              <td>${new Date(record.damageDate).toLocaleDateString()}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    ` : '<h3>No Items Damaged During Period</h3>';

    // Lending Activity section
    const lendingDetailsTable = lending.length > 0 ? `
      <h3>Lending Activity During Period</h3>
      <table>
        <thead>
          <tr>
            <th>Item ID</th>
            <th>Item Name</th>
            <th>Category</th>
            <th>Lent To</th>
            <th>Date Lent</th>
          </tr>
        </thead>
        <tbody>
          ${lending.map(record => `
            <tr>
              <td>${record.itemId}</td>
              <td>${record.itemName}</td>
              <td>${record.category}</td>
              <td>${record.lentTo}</td>
              <td>${new Date(record.lentDate).toLocaleDateString()}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    ` : '<h3>No Lending Activity During Period</h3>';

    // Deleted Items Details section
    const deletedItemsTable = deletedItemsInPeriod.length > 0 ? `
      <h3>Items Deleted During Period</h3>
      <table>
        <thead>
          <tr>
            <th>Item ID</th>
            <th>Item Name</th>
            <th>Category</th>
            <th>Purchase Price (₦)</th>
            <th>Date Added</th>
            <th>Date Deleted</th>
          </tr>
        </thead>
        <tbody>
          ${deletedItemsInPeriod.map(record => `
            <tr>
              <td>${record.id}</td>
              <td>${record.name}</td>
              <td>${record.category}</td>
              <td>${record.price.toLocaleString()}</td>
              <td>${new Date(record.dateAdded).toLocaleDateString()}</td>
              <td>${new Date(record.deleteDate).toLocaleDateString()}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    ` : '<h3>No Items Deleted During Period</h3>';

    previewContent.innerHTML = `
      <h3>Inventory Summary for ${report.period}</h3>
      <div class="stat-group">
        <div class="stat-item">
          <div class="stat-value">${report.itemsAtStart}</div>
          <div class="stat-label">Items at Period Start</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${report.fullInventory.length}</div>
          <div class="stat-label">Current Total Items</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${report.total}</div>
          <div class="stat-label">Total Items in Period</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${report.newItemsInPeriod}</div>
          <div class="stat-label">New Items In Period</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${report.deletionsInPeriod}</div>
          <div class="stat-label">Items Deleted In Period</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${report.damagesInPeriod}</div>
          <div class="stat-label">Items Damaged In Period</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${report.lendsInPeriod}</div>
          <div class="stat-label">Items Lent In Period</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${report.active}</div>
          <div class="stat-label">Currently Active Items</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${report.damaged}</div>
          <div class="stat-label">Currently Damaged</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${report.lent}</div>
          <div class="stat-label">Currently Lent</div>
        </div>
      </div>
      ${newItemsTable}
      ${damagedItemsTable}
      ${lendingDetailsTable}
      ${deletedItemsTable}
      <h3>Full Inventory</h3>
      <table>
        <thead>
          <tr>
            <th>Item ID</th>
            <th>Name</th>
            <th>Category</th>
            <th>Purchase Price (₦)</th>
            <th>Status</th>
            <th>Date Added</th>
            <th>Last Updated</th>
          </tr>
        </thead>
        <tbody>
          ${report.fullInventory.map(item => `
            <tr>
              <td>${item.id}</td>
              <td>${item.name}</td>
              <td>${item.category}</td>
              <td>${item.price.toLocaleString()}</td>
              <td><span class="status-badge status-${item.status}">${item.status}${item.lentTo ? ` to ${item.lentTo}` : ''}</span></td>
              <td>${new Date(item.dateAdded).toLocaleDateString()}</td>
              <td>${new Date(item.lastUpdated).toLocaleDateString()}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;

    this.currentReport = {data: report, email: email};
    document.getElementById('reportPreviewModal').style.display = 'flex';
  }

  sendReport() {
    if (!this.currentReport) return;

    const statusDiv = document.getElementById('report-status');
    statusDiv.innerHTML = '<p style="color: #28a745;">Sending report...</p>';

    this.closeModal('reportPreviewModal');

    setTimeout(() => {
      statusDiv.innerHTML = `
        <p style="color: #28a745;">
          ✓ Report for ${this.currentReport.data.period} has been sent to ${this.currentReport.email}
        </p>
      `;
      document.getElementById('report-email').value = '';
      this.logActivity(`Monthly report for ${this.currentReport.data.period} sent to ${this.currentReport.email}`);
      this.currentReport = null;
    }, 1500);
  }

  resetForm() {
    document.getElementById('asset-form').reset();
  }

  logout(force = false) {
    if (force || confirm('Are you sure you want to log out?')) {
      clearTimeout(this.inactivityTimeout);
      if (!force) { // Only log manual logout if not forced
        this.logActivity('Manual logout from location');
      }
      this.currentLocation = null;
      this.updateUI();
      this.showLocationModal();
      document.getElementById('location-password').value = '';
      document.getElementById('current-location').textContent = 'Not Selected';
    }
  }
}

// Initialize the system
const inventorySystem = new InventorySystem();
</script>
</body>
</html>